
@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Color theme for statusbar -->
    <meta name="theme-color" content="#2196f3">



    <link href="https://iretailerapp.flnet.com/Content/framework7.css" rel="stylesheet">

    <title>请假</title>

    <script type="text/javascript" src="https://iretailerapp.flnet.com/Scripts/framework7.min.js"></script>
    <script src="https://cdn.bootcss.com/echarts/4.0.4/echarts.min.js"></script>
    <style>
        .tabNoSelect {
             width:33%; height: 41px;float:left; text-align:center;font-size:15px;line-height:43px;color:#acacac;background-color:#ffffff;
        }

        .tabSelect {
           width:33%; height: 41px;float:left; text-align:center;font-size:15px;line-height:43px;color:#24acca;border-bottom:solid;border-color:#24acca;border-width:2px;background-color:#ffffff;
        }
    </style>
</head>
<body>

    @{
        string userId = (string)ViewData["userId"];

        
        
        //List<Market.APIService.Controllers.CusModel> Vdata = (List < Market.APIService.Controllers.CusModel>) ViewData["vModel"];
    }
    <div id="app" style="background-color:rgb(247,247,247);">
        <div class="view view-main">

            <div id="Dview" style="padding-top:0px;padding-left:0px;padding-right:0px;" class="page-content">
                <div style="width:100%;height:10px;display:flex;">
                </div>
                <div style="width:100%;height:94px;display:flex;">
                    <div style="width:20px;height:100%;float:left"></div>

                    <div style="flex:0.5; height:100%;float:left;background-color:#ffffff;box-shadow:0 2px 10px rgba(0,0,0,0.2); ">
                        <div style="width:100%;height:15px;" ></div>
                        <div id="lib_yearDay" style="width:100%;height:40px;line-height:40px;font-size:40px;text-align:center;">20</div>
                        <div style="width:100%;height:4px;"></div>
                        <div style="width:100%;height:14px;line-height:14px;font-size:14px;text-align:center;">可休假天数</div>
                    </div>

                    <div style="width:12px;height:100%;float:left"></div>
                    <div style="flex:0.5; height:100%;float:left;background-color:#ffffff;box-shadow:0 2px 10px rgba(0,0,0,0.2); ">
                        <div style="width:100%;height:15px;"></div>
                        <div id="lib_leveDay" style="width:100%;height:40px;line-height:40px;font-size:40px;text-align:center;">20</div>
                        <div style="width:100%;height:4px;"></div>
                        <div style="width:100%;height:14px;line-height:14px;font-size:14px;text-align:center;">已休假天数</div>
                    </div>
                    <div style="width:20px;height:100%;float:left"></div>
                    
                   
                </div>
                <div style="width:100%;height:15px;display:flex;">
                </div>
                <div style="width: 100%; height: 50px; text-align: left; display:flex; border-color:#d4d4d8; border-bottom:solid;border-width:1px;">
                    <div style="width: 10px; height: 50px;float:left;"> </div>
                    <div style="flex:0.5; height: 50px;float:left;text-align:left;font-size:14px;line-height:50px;color:#333333">请假类型</div>
                    <div style="flex:0.5; height: 50px;float:left;text-align:left;font-size:14px;line-height:50px;color:#333333"></div>
                    <div id="lab_data_1" style="width:50px; height: 50px;float:left;text-align:right;font-size:14px;line-height:50px;color:#333333">
                        <div style="width:100%;height:17px;display:flex;">
                        </div>
                    <select id="leaveType" style="width:50px;text-align:right; ">
    <option value="1">产假</option>
    <option value="2">病假</option>
    <option value="3" selected="selected">事假</option>
    <option value="4">婚假</option>
    <option value="5">丧假</option>
    <option value="6">护理假</option>
    <option value="7">年休假</option>
    <option value="8">休息</option>
</select></div>
                    <div style="width: 2px; height: 50px;float:left;"> </div>
                    <div style="width:25px;height:50px;float:left;color:#000000;font-size:14px;">
                        <div style="width:100%;height:18px;display:flex;">
                        </div>
                        <div style="width:15px; height:15px;">
                            <img src="~/Content/Img/img_next.png" style="width:15px; height:15px; " />
                        </div>
                    </div>
                </div>
                <div style="width: 100%; height: 50px; text-align: left;display:flex; border-color:#d4d4d8; border-bottom:solid;border-width:1px;">
                    <div style="width: 10px; height: 50px;float:left;"> </div>
                    <div style="flex:1; height: 50px;float:left;text-align:left;font-size:14px;line-height:50px;color:#333333">开始日期/时间</div>
                    <div style="height: 50px;float:left;text-align:right;font-size:14px;color:#333333">
                        <div style="width:100%;height:17px;display:flex;">
                        </div>
                        <div style="width:100%;display:flex;">
                            <input type="date" id="startDay" onchange="changeDate()" style="text-align:right;" placeholder="开始日期" value="@System.DateTime.Now.ToString("yyyy-MM-dd")" />
                        </div>
                        
                    </div>
                    
                    <div style="width: 2px; height: 50px;float:left;"> </div>
                    <div style="width:25px;height:50px;float:left;color:#000000;font-size:14px;">
                        <div style="width:100%;height:18px;display:flex;">
                        </div>
                        <div style="width:15px; height:15px;">
                            <img src="~/Content/Img/img_next.png" style="width:15px; height:15px; " />
                        </div>
                    </div>
                </div>
               
                <div style="width: 100%; height: 50px; text-align: left;display:flex; border-color:#d4d4d8; border-bottom:solid;border-width:1px;">
                    <div style="width: 10px; height: 50px;float:left;"> </div>
                    <div style="flex:1; height: 50px;float:left;text-align:left;font-size:14px;line-height:50px;color:#333333">结束日期/时间</div>
                    <div style="height: 50px;float:left;text-align:right;font-size:14px;color:#333333">
                        <div style="width:100%;height:17px;display:flex;">
                        </div>
                        <div style="width:100%;display:flex;">
                            <input type="date" id="endDay"  onchange="changeDate()" style="text-align:right;" placeholder="开始日期" value="@System.DateTime.Now.ToString("yyyy-MM-dd")" />
                        </div>

                    </div>
                    
                    <div style="width: 2px; height: 50px;float:left;"> </div>
                    <div style="width:25px;height:50px;float:left;color:#000000;font-size:14px;">
                        <div style="width:100%;height:18px;display:flex;"></div>
                        <div style="width:15px; height:15px;">
                            <img src="~/Content/Img/img_next.png" style="width:15px; height:15px; " />
                        </div>
                    </div>
                </div>
                <div style="width: 100%; height: 50px; text-align: left; display:flex; border-color:#d4d4d8; border-bottom:solid;border-width:1px;">
                    <div style="width: 10px; height: 50px;float:left;"> </div>
                    <div style="flex:1; height: 50px;float:left;text-align:left;font-size:14px;line-height:50px;color:#333333">请假时间</div>
                    <div id="lib_days" style="height: 50px;float:left;text-align:right;font-size:14px;line-height:50px;color:#333333">
                       
                    
                            1天
                        
                    </div>
                    <div style="width:10px; height: 50px;float:left;"> </div>
                   
                </div>
                <div style="width: 100%; height: 50px; text-align: left; display:flex; border-color:#d4d4d8; border-bottom:solid;border-width:1px;">
                    <div style="width: 10px; height: 50px;float:left;"> </div>
                    <div style="flex:1; height: 50px;float:left;text-align:left;font-size:14px;line-height:50px;color:#333333">备注</div>
                    <div style="height: 50px;float:left;text-align:right;font-size:14px;color:#333333">
                        <div style="width:100%;height:17px;display:flex;">
                        </div>
                        <div style="width:100%;display:flex;">
                            <textarea id="desc"placeholder="请填写备注" maxlength="100" ></textarea>
                        </div>
                    </div>

                    <div style="width: 2px; height: 50px;float:left;"> </div>
                    <div style="width:25px;height:50px;float:left;color:#000000;font-size:14px;">
                        <div style="width:100%;height:18px;display:flex;">
                        </div>
                        <div style="width:15px; height:15px;">
                            <img src="~/Content/Img/img_next.png" style="width:15px; height:15px; " />
                        </div>
                    </div>
                </div>
                <div style="width: 100%; height: 50px; text-align: left; display:flex; border-color:#d4d4d8; border-bottom:solid;border-width:1px;">
                    <div style="width: 10px; height: 50px;float:left;"> </div>
                    <div style="flex:0.2; height: 50px;float:left;text-align:left;font-size:14px;line-height:50px;color:#333333">附件</div>
                    <div id="images_view" style="flex:0.8; height: 50px;float:left;text-align:right;font-size:14px;line-height:50px;color:#333333">
                        
                    </div>
                    <div style="height: 50px;float:left;text-align:right;font-size:14px;line-height:50px;color:#333333">
                        <div style="width:100%;height:5px;display:flex;">
                        </div>
                        <form id="imageForm" enctype="multipart/form-data">
                            <img src="~/Content/Img/btn_camera.png" style="height:40px;width:40px;" onclick="SeleectImage();" />
                            <input id="fileBtn" name="fileBtn" type="file" style="display:none; background-image:url('~/Content/Img/btn_camera.png')" onchange="upload('#fileBtn');" accept="image/*" multiple />
                        </form>
</div>
                    <div style="width:10px; height: 50px;float:left;"> </div>
                   
                </div>
                <div style="width:100%; height: 50px;float:left;"> </div>
                <div  style="width:100%; height: 50px;float:left;display:flex;">
                    <div style="width:10px; height: 50px;float:left;"> </div>
                    <div  onclick="SaveData();" style="flex:1;width:100%; height: 50px;float:left; line-height:50px; font-size:15px; text-align:center;border:solid;border-width:1px;">
                        保存
                    </div>
                    <div style="width:10px; height: 50px;float:left;"> </div>
                </div>
                <div hidden="hidden">
                    <div style="width:256px;display:block;border-radius:2px;background-color:white; left:50%;margin-left:-128px;" class="dialog dialog-no-buttons" id="dig_clockInfo_Ok">
                        <div style="width:100%;height:10.5px;font-size:10.5px;color:black; display:flex;flex-flow:row;text-align:center;">
                        </div>
                        <div style="width:100%;font-size:11px;color:black; display:flex;flex-flow:row;text-align:center;">
                            <div style="flex:0.5;"></div><img src="~/Content/Img/img_success.png" style="width:90px;height:90px;" />
                            <div style="flex:0.5;"></div>
                        </div>
                        <div style="width:100%;font-size:11px;color:black; display:flex;flex-flow:row;text-align:center;">
                            <div style="flex:0.5;"></div>
                            <div>
                                请假提交成功
                            </div>
                            <div style="flex:0.5;"></div>
                        </div>

                        <div onclick="javascript: InfoDialog.close();" style="width:100%;height:44px;float:left;text-align:center; line-height:44px;font-size:11px;border:solid;border-width:1px;border-left:none; border-right:none; border-bottom:none;border-color:#b1b1b1;color:#36b8d5;">
                            确定
                        </div>
                    </div>
                    <div style="width:256px; display:block;border-radius:2px;background-color:white; left:50%;margin-left:-128px;" class="dialog dialog-no-buttons" id="dig_clockInfo_fail">
                        <div style="width:100%;height:10.5px;font-size:10.5px;color:black; display:flex;flex-flow:row;text-align:center;">
                        </div>
                        <div style="width:100%;font-size:10.5px;color:black; display:flex;flex-flow:row;text-align:center;">
                            <div style="flex:0.5;"></div><img src="~/Content/Img/img_fail.png" style="width:90px;height:90px;" />
                            <div style="flex:0.5;"></div>
                        </div>
                        <div style="width:100%;font-size:11px;color:black; display:flex;flex-flow:row;text-align:center;">
                            <div style="flex:0.5;"></div>
                            <div id="lib_info">
                                打卡失败
                            </div>
                            <div style="flex:0.5;"></div>
                        </div>
                        <div onclick="javascript: InfoDialog.close();" style="width:100%;height:44px;float:left;text-align:center; line-height:44px;font-size:11px;border:solid;border-width:1px;border-left:none; border-right:none; border-bottom:none;border-color:#b1b1b1;color:#36b8d5;">
                            确定
                        </div>
                    </div>
                </div>
                
            </div>





    </div>
</div>

    <script>
        var isSelectImage = false;
        var InfoDialog;
        function changeDate()
        {
            myApp.request.json('GetDays?startDay=' + $$("#startDay").val() + "&endDay=" + $$("#endDay").val(),
               null,
               function (data) {
                   //alert(data.day);
                   $$("#lib_days").text(data.day);
               });
        }
        function getLeveDay() {
            myApp.request.json('GetLeveDays?userId=' + "@userId",
               null,
               function (data) {
                   //alert(data.day);
                   $$("#lib_leveDay").text(data.leveDay);
                   $$("#lib_yearDay").text(data.yearDay);
               });
        }
        function SaveData()
        {
            myApp.dialog.preloader('处理中...');
            if (isSelectImage) {
                var formData = new FormData(document.querySelector('#imageForm'));
                myApp.request.post('https://iretailerapp.flnet.com/api/marketApi/UploadImageV3',
                   formData,
                   function (data) {
                       var obj = JSON.parse(data);
                       var r = "LeaveV2?userId=" + "@userId" + "&startDay=" + $$("#startDay").val() + "&endDay=" + $$("#endDay").val() + "&desc=" + $$("#desc").val() + "&leaveType=" + $$("#leaveType").val() + "&fileId=" + obj.fileId;

                       myApp.request.post(
                           r,{},
                           function (data) {
                               myApp.dialog.close();
                               if (data == '1') {
                                    InfoDialog = myApp.dialog.create({
                                       text: "",
                                       el: '#dig_clockInfo_Ok',
                                       buttons: [

                                       ]
                                   });
                                   InfoDialog.open();
                               }
                               else {
                                    InfoDialog = myApp.dialog.create({
                                       text: "",
                                       el: '#dig_clockInfo_fail',
                                       buttons: [

                                       ]
                                   });
                                   $$('#lib_info').text(data);
                                   InfoDialog.open();
                               }

                           }

                       );
                       //alert(obj.fileId);
                   });
            }
            else {

                var r = "LeaveV2?userId=" + "@userId" + "&startDay=" + $$("#startDay").val() + "&endDay=" + $$("#endDay").val() + "&desc=" + $$("#desc").val() + "&leaveType=" + $$("#leaveType").val() + "&fileId=";

                       myApp.request.post(
                           r,{},
                           function (data) {
                               myApp.dialog.close();
                               if (data == '1') {
                                    InfoDialog = myApp.dialog.create({
                                       text: "",
                                       el: '#dig_clockInfo_Ok',
                                       buttons: [

                                       ]
                                   });
                                   InfoDialog.open();
                               }
                               else {
                                    InfoDialog = myApp.dialog.create({
                                       text: "",
                                       el: '#dig_clockInfo_fail',
                                       buttons: [

                                       ]
                                   });
                                   $$('#lib_info').text(data);
                                   InfoDialog.open();
                               }

                           }

                       );
                       //alert(obj.fileId);

            }
        }
        function UploadImage()
        {

            var formData = new FormData(document.querySelector('#imageForm'));
            myApp.request.post('https://iretailerapp.flnet.com/api/marketApi/UploadImageV3',
               formData,
               function (data) {
                   var obj = JSON.parse(data);
                   //alert(obj.fileId);
               });
        }
        function SeleectImage()
        {
            $$('#fileBtn').click();
        }
        function setup_reader(file, ImageView) {

            var name = file.name;
            var reader = new FileReader();
            reader.onload = function (e) {
                ImageView.setAttribute("src", e.target.result);

                // do sth with text

                //var li = document.createElement("li");
                //li.innerHTML = name;
                //ul.appendChild(li);
            }
            reader.readAsDataURL(file);
            //reader.readAsBinaryString(file);
        }
        var upload = function (c) {
            isSelectImage = true;
            var $c = document.querySelector(c);
            var imageViewHtml = "";
            var ct = $c.files.length;
            if (ct > 4)
            {
                alert('选择的图片超过5张，只会上传前5张');
                ct = 4;
            }
            else
            {
                ct=ct-1
            }
            for (var i = 0; i <= ct; i++)
            {
                imageViewHtml = imageViewHtml + '<div style="width:45px;height:50px;float:left;">'
                           + ' <div style="width:100%;height:5px;display:flex;">'
                           + ' </div>'
                          + '  <img id="image_' + i + '" src="" style="height:40px;width:40px;" />'
                       + ' </div>';

            }
            $$('#images_view').html(imageViewHtml);
            for (var i = 0; i <= ct; i++) {
                var $d = document.querySelector("#image_"+i);
                var file = $c.files[i];
                setup_reader(file, $d);
            }

        };
        var myApp = new Framework7({
            // App root element
            root: '#app',
            // App Name
            name: 'My App',
            // App id
            id: 'com.myapp.test',
            // Enable swipe panel
            panel: {
                swipe: 'left',
            },
            // Add default routes
            routes: [
              {
                  path: '/about/',
                  url: 'about.html',
              },
            ],
            // ... other parameters
        });
        var $$ = Framework7.$;
        var myPhotoBrowserStandalone = myApp.photoBrowser.create({
            photos: [
                'http://lorempixel.com/1024/1024/sports/1/',
                'http://lorempixel.com/1024/1024/sports/2/',
                'http://lorempixel.com/1024/1024/sports/3/',
            ]
        });
        function ClickType(type) {

            //myPhotoBrowserStandalone.open();
            if (type == 1) {
                $$('#type_view_3').hide();
                $$('#type_view_2').hide();
                $$('#type_view_1').show();
                if ($$('#btn_typ1').hasClass("tabSelect") == true) {
                    $$('#btn_typ1').removeClass("tabSelect");
                }
                if ($$('#btn_typ1').hasClass("tabNoSelect") == true) {
                    $$('#btn_typ1').removeClass("tabNoSelect");
                }
                if ($$('#btn_typ2').hasClass("tabSelect") == true) {
                    $$('#btn_typ2').removeClass("tabSelect");
                }
                if ($$('#btn_typ2').hasClass("tabNoSelect") == true) {
                    $$('#btn_typ2').removeClass("tabNoSelect");
                }
                if ($$('#btn_typ3').hasClass("tabSelect") == true) {
                    $$('#btn_typ3').removeClass("tabSelect");
                }
                if ($$('#btn_typ3').hasClass("tabNoSelect") == true) {
                    $$('#btn_typ3').removeClass("tabNoSelect");
                }
                $$('#btn_typ1').addClass("tabSelect");
                $$('#btn_typ2').addClass("tabNoSelect");
                $$('#btn_typ3').addClass("tabNoSelect");


            }
            else if (type == 2) {
               // $$('#table_clock').hide();
                //$$('#table_clockDetail').show();
                $$('#type_view_3').hide();
                $$('#type_view_1').hide();
                $$('#type_view_2').show();
                if ($$('#btn_typ1').hasClass("tabSelect") == true) {
                    $$('#btn_typ1').removeClass("tabSelect");
                }
                if ($$('#btn_typ1').hasClass("tabNoSelect") == true) {
                    $$('#btn_typ1').removeClass("tabNoSelect");
                }
                if ($$('#btn_typ2').hasClass("tabSelect") == true) {
                    $$('#btn_typ2').removeClass("tabSelect");
                }
                if ($$('#btn_typ2').hasClass("tabNoSelect") == true) {
                    $$('#btn_typ2').removeClass("tabNoSelect");
                }
                if ($$('#btn_typ3').hasClass("tabSelect") == true) {
                    $$('#btn_typ3').removeClass("tabSelect");
                }
                if ($$('#btn_typ3').hasClass("tabNoSelect") == true) {
                    $$('#btn_typ3').removeClass("tabNoSelect");
                }
                $$('#btn_typ2').addClass("tabSelect");
                $$('#btn_typ1').addClass("tabNoSelect");
                $$('#btn_typ3').addClass("tabNoSelect");


            }
            else if (type == 3) {
                // $$('#table_clock').hide();
                //$$('#table_clockDetail').show();
                $$('#type_view_2').hide();
                $$('#type_view_1').hide();
                $$('#type_view_3').show();
                if ($$('#btn_typ1').hasClass("tabSelect") == true) {
                    $$('#btn_typ1').removeClass("tabSelect");
                }
                if ($$('#btn_typ1').hasClass("tabNoSelect") == true) {
                    $$('#btn_typ1').removeClass("tabNoSelect");
                }
                if ($$('#btn_typ2').hasClass("tabSelect") == true) {
                    $$('#btn_typ2').removeClass("tabSelect");
                }
                if ($$('#btn_typ2').hasClass("tabNoSelect") == true) {
                    $$('#btn_typ2').removeClass("tabNoSelect");
                }
                if ($$('#btn_typ3').hasClass("tabSelect") == true) {
                    $$('#btn_typ3').removeClass("tabSelect");
                }
                if ($$('#btn_typ3').hasClass("tabNoSelect") == true) {
                    $$('#btn_typ3').removeClass("tabNoSelect");
                }
                $$('#btn_typ2').addClass("tabNoSelect");
                $$('#btn_typ1').addClass("tabNoSelect");
                $$('#btn_typ3').addClass("tabSelect");


            }


        }
        ClickType(2);
        changeDate();
        getLeveDay();
    </script>


    <!-- Path to your app js-->



</body>
</html>
